services:
    caddy:
      command: ["caddy", "run", "--config", "/etc/caddy/Caddyfile"]
      environment:
        CADDY_ADMIN_EMAIL: ${CADDY_ADMIN_EMAIL:-admin@impious.test}
        GAME_API_ENABLED: ${GAME_API_ENABLED:-1}
      ports:
        - "80:80"
        - "443:443"
        - "443:443/udp"
        - "8080:80"
        - "8443:443"
        - "8443:443/udp"
    volumes:
      - ./Caddyfile.dev:/etc/caddy/Caddyfile:ro
      - ${SITE_BUNDLE_PATH:-../site/public}:/srv/site:ro
      - ${CODEX_PAYLOAD_DEV_PATH:-../codex-payload-dev}:/srv/codex:ro
      - caddy_data_dev:/data
      - caddy_config_dev:/config

  game-api:
    profiles: ['game']
    image: hashicorp/http-echo:0.2.3
    command:
      - "-text=impious game-api placeholder"
      - "-listen=:3000"
    ports:
      - "3000:3000"
    # To exercise the real backend locally, override this service with your implementation
    # using docker compose --profile game -f docker-compose.yml -f docker-compose.dev.yml -f <override>.yml

volumes:
  caddy_data_dev:
  caddy_config_dev:
