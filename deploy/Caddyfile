{
    # Global options
}

# Main Site
{$SITE_ADDRESS} {
    root * /srv/site

    log {
        output stdout
        format console
    }

    # API Routes
    @enlist path /enlist*
    handle @enlist {
        header X-Impious-Enlist "1"
        reverse_proxy enlist-api:3000
    }

    @health path /healthz
    handle @health {
        reverse_proxy enlist-api:3000
    }

    encode zstd gzip
    try_files {path} {path}/ /index.html
    file_server

    # TLS: "internal" for dev, email address for prod
    tls {$TLS_OPTS}
}

# WWW Redirect
{$WWW_ADDRESS} {
    redir https://{$SITE_ADDRESS}{uri}
}

# Future Game API Stub
{$GAME_ADDRESS} {
    tls {$TLS_OPTS}
    respond "game-api stubbed" 200
}
