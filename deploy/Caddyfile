impious.io {
    root * /srv/site

<<<<<<< HEAD
    log {
        output stdout
        format console
    }

    @enlist path /enlist*
    handle @enlist {
        header X-Impious-Enlist "1"
        reverse_proxy enlist-api:3000
    }

    @health path /healthz
    handle @health {
        reverse_proxy enlist-api:3000
    }

    encode zstd gzip
    try_files {path} {path}/ /index.html
    file_server
=======
    route {
        # API first, in-order, terminal when matched
        reverse_proxy /enlist* enlist-api:3000
        reverse_proxy /healthz enlist-api:3000

        # everything else = static site
        encode zstd gzip
        try_files {path} {path}/ /index.html
        file_server
    }
>>>>>>> fafee7a (fix(caddy): force ordered routing for /enlist and /healthz via route block)
}

www.impious.io {
    redir https://impious.io{uri}
}
