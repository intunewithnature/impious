{
    # Dev/staging stack never talks to Let's Encrypt. Each site block
    # explicitly declares its TLS behavior (mostly `tls internal`).
    email you@example.com
    auto_https off
}

(serve_site) {
    root * /srv/site
    encode zstd gzip
    try_files {path} {path}/ /index.html
    file_server
    header +X-Impious-Env "dev"
}

# Local iteration domains (see README-dev for /etc/hosts entries).
impious.test, www.impious.test, localhost {
    tls internal
    import serve_site

    handle /healthz {
        respond "impious-dev-ok" 200
    }
}

# Optional remote staging hostnames ride plain HTTP so the VPS that mirrors
# this compose stack never interferes with production certificates.
http://staging.impious.io, http://stage.impious.io {
    import serve_site
}

# Keep the future game/API endpoint obvious during dev; swap `respond` for
# `reverse_proxy game-api:3000` once the container exists on the network.
game.impious.test {
    tls internal
    respond "game-api stubbed in dev; bring up game-api to proxy requests" 200
}
